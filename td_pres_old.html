<!doctype html>
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>td presentation problématiques</title>

<script src="/rsrc/tools/h/jquery-1.11.3/jquery.min.js"></script>



<link href="/rsrc/tools/uv/solarized.css" media="screen,projection,print" rel="Stylesheet" type="text/css" />
<script src="/rsrc/tools/stat/statInfAEP/distributions.js"></script>
<script src="/rsrc/tools/stat/miniR/miniR.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="/rsrc/tools/css/ascidoctor.css">
<link rel="stylesheet"  href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<script src="/rsrc/tools/clipboard/clipboard.min.js"></script>
<style type="text/css" media="screen">
.demoR:hover {cursor: zoom-in;}
.trigger_doc {
  cursor: pointer;
}
</style>
<script type="text/javascript">
var demoRFigs={};
</script>

<link rel="stylesheet" type="text/css" href="/rsrc/tools/Semantic-UI-CSS/semantic.min.css"><link rel="stylesheet" type="text/css" href="/rsrc/tools/Semantic-UI-CSS/components/message.min.css"><link rel="stylesheet" type="text/css" href="/rsrc/tools/Semantic-UI-CSS/components/icon.min.css"><script src="/rsrc/tools/Semantic-UI-CSS/semantic.min.js"></script>


<link rel="stylesheet" href="/rsrc/tools/uv/solarized.css" />


</head>
<body><div class="ui  container">

<div id="content">






<h2> Exercice 1 : Election 2ème tour Max</h2>

 Entre les deux tours d'une élection présidentielle, un candidat, Max, souhaiterait ``rapidement'' avoir un a priori sur la proportion d'intentions de vote en sa faveur. On notera $\pmb{\mathcal{Y}}^{ Max}=\left( \mathcal{Y}_1^{Max},\ldots, \mathcal{Y}_N^{Max}\right)$ l'ensemble des réponses des $N$ électeurs (où $\mathcal{Y}_i^{Max}$ vaut 1 si l'individu $i$ a l'intention de voter pour Max et 0 sinon).

<br/>(1) Déterminez en fonction de $\pmb{\mathcal{Y}}^{ Max}$, le nombre puis la proportion d'intentions de vote en faveur de Max, notée respectivement $N^{Max}$ et $p^{Max}$.

<button id="ok_max_pop_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_max_pop">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>
<ol>
<li>$N^{Max}:= \sum_{i=1}^N \mathcal{Y}_i^{Max}$</li>
<li>$p^{Max}:= \frac{N^{Max}}N = \frac1N \sum_{i=1}^N \mathcal{Y}_i^{Max}$</li>
</ol>
</div></div></div>



<br/>(2) $N$ étant très grand, quel serait une solution réalisable permettant d'obtenir un remplaçant (i.e. estimation) de $p^{Max}$. Proposez les notations adéquates.

<button id="ok_max_ech_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_max_ech">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>Une solution consiste à interroger un nombre $n << N$ d'individus. Ce jeu de données pourrait être noté ${\mathbf{  y^{Max}  }}$ et le remplaçant de $p^{Max}$ pourrait alors être calculé par $\widehat{  p^{Max} }\left({\mathbf{ { y^{Max} } }}\right):=\frac1n \sum_{i=1}^n y_i^{Max}$.
</div></div></div>



<br/>(3) Deux personnes se proposent d'interroger chacun $n=1000$ électeurs. On notera ${\mathbf{  y_{[1]}  }}$ et ${\mathbf{  y_{[2]}  }}$ ces deux jeux de données recueillis. Les estimations correspondantes sont respectivement de $47\%$ et $52\%$. Comment interpréter la différence des résultats qui, si on leur fait une confiance aveugle, conduit à deux conclusions différentes?

<button id="ok_max_2echs_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_max_2echs">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>La différence des résultats peut s'expliquer par le fait qu'un échantillon de taille $n$ ne constitue qu'une sous-information de la population de taille $N$.
</div></div></div>



<br/>(4)Connaissez-vous d'autres applications nécessitant une estimation d'un paramètre inconnu ?
<button id="ok_max_autres_pbs_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_max_autres_pbs">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>normes de production, normes écologiques, ... </div></div></div>



<h2> Exercice 2 : Présentation des problématiques des produits A et B</h2>


<div class="ui yellow message">
Un industriel veut lancer sur le marché deux produits que l'on nommera Produit $A$ et Produit $B$. Le Produit $A$ est acheté au plus une fois par mois tandis que le Produit $B$ peut être acheté autant de fois que désiré. Après une étude financière, les services comptables indiquent à cet industriel que pour que le lancement de chacun de ces produits soit rentable, il faut qu'il soit vendu à plus de 300000 exemplaires par mois. La population ciblée par l'industriel est une population de taille $N=2000000$. L'industriel se demande s'il doit ou non lancer le(s) _Produit(s) A et/ou B_. 
</div>

Commençons par introduire quelques notations permettant de décrire le choix d'achat des individus de la population totale (ciblée par l'industriel). Les deux études des Produit $A$ et Produit $B$ étant plutôt similaires, nous noterons donc dans un cadre général  $\bullet$ aussi bien à la place de $A$ ou $B$. Ainsi  
$\mathcal{Y}^{\bullet}_i$ représente le nombre de produit(s) $\bullet$ acheté(s) par le $i^{\grave eme}$ ($i=1,\cdots,N$) individu de la population totale. L'ensemble des choix d'achat des $N$ individus $\left(\mathcal{Y}_i\right)_{i=1,\cdots,N}$ sera noté $\pmb{\mathcal{Y}}^{ \bullet}$. $N^{\bullet}$ désignera le nombre d'exemplaires de Produit $\bullet$ achetés par les N individus de la population. 

<br/>(1) Exprimez $N^A$ (resp. $N^B$) en fonction des  $\pmb{\mathcal{Y}}^{ A}$ (resp. $\pmb{\mathcal{Y}}^{ B}$). Exprimez la rentabilité du Produit $A$ (resp. Produit $B$) en fonction du nombre total $N^A$ (resp. $N^B$) d'exemplaires du Produit $A$ (resp. Produit $B$) vendus.
 
<button id="ok_prodAB_q1_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_prodAB_q1">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>Le produit $\bullet$ est rentable si $N^\bullet:=\sum_{i=1}^N \mathcal{Y}_i^\bullet > 300000$.</div></div></div>


<br/>(2) Même question mais en fonction du nombre moyen (par individu de la population) $\mu^A$ (resp. $\mu^B$) d'exemplaires du Produit $A$ (resp. Produit $B$) en ayant au préalable établi la relation entre $\mu^A$ et $N^A$ (resp. $\mu^B$ et $N^B$) et ainsi entre $\mu^A$ et $\pmb{\mathcal{Y}}^{ A}$ (resp. $\mu^B$ et $\pmb{\mathcal{Y}}^{ B}$). Quelle relation y a-t-il donc entre $\mu^A$ et $\overline{\mathcal{Y}^A}$ (resp. entre $\mu^B$ et $\overline{\mathcal{Y}^B}$) ?

<div class="ui yellow message">Les quantités $\mu^A$ et $\mu^B$ seront appelées <b>paramètres d'intérêt</b>.</div>

<button id="ok_prodAB_q2_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_prodAB_q2">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>Le produit $\bullet$ est rentable si $\mu^\bullet:=\frac1N\sum_{i=1}^N \mathcal{Y}_i^\bullet = \overline{\mathcal{Y^\bullet}} > \frac{300000}{2000000}=0.15$.</div></div></div>


<br/>(3) Est-il possible pour l'industriel de ne pas se tromper dans sa décision quant au lancement de chaque produit ? Si oui, comment doit-il procéder ? Cette solution est-elle réalisable ? 

<button id="ok_prodAB_q3_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_prodAB_q3">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>Pour ne pas se tromper, il lui faut recueillir les intentions des $N$ individus ce qui paraît peu réalisable.</div></div></div>


<br/>(4) Est-il alors possible d'évaluer (exactement) les paramètres d'intérêt ? Comment les qualifieriez-vous par la suite ?
 
<button id="ok_prodAB_q4_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_prodAB_q4">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>Les paramètres d'intérêt ne peuvent donc pas être évalués et sont donc considérés comme INCONNUS.</div></div></div>


<br/>(5) Une solution réalisable est alors de n'interroger qu'une sous-population de taille raisonnable $n << N$ (ex $n=1000$). On notera alors ${\mathbf{  y  }}^\bullet$ le jeu de données (appelé aussi échantillon), i.e. le vecteur des $n$ nombres d'achat $\left(y_i^\bullet\right)_{i=1,\cdots,n}$ du produit $\bullet$ des $n$ ($n << N$) individus interrogés.

<div class="ui yellow message">Cet unique jeu de données ${\mathbf{  y
\bullet  }}$ sera créé un jour particulier, le <b>jour J</b>. Ce jour là (et seulement ce jour là) nous pourrons décider ou pas de lancer le produit $\bullet$ sur le marché.</div>

Chronologiquement, tous les raisonnements qui se situeront <b>avant le jour J</b> seront consacrés à la mise en place de l'outil d'aide à la décision. 


Comment l'industriel pourra-t-il évaluer un remplaçant de $\mu^\bullet$ à partir de son échantillon ${\mathbf{  y  }}^\bullet$ ? 
 
<div class="ui yellow message">
Cette quantité désomais notée $\widehat{  \mu^{\bullet} }\left({\mathbf{ { y^{\bullet} } }}\right)$ se traduit littéralement par ``remplaçant" de $\mu^\bullet$ obtenu à partir du vecteur des données ${\mathbf{  y  }}$ ( <i>convention:</i> le symbole <u>accent circonflexe</u> sur un paramètre signifie <b>estimation</b> ou ``remplaçant" de celui-ci et les symboles <u>parenthèses</u> contiennent les informations nécessaires pour son obtention). 
</div>

(quelle est la relation entre $\overline{y^\bullet}$, représentant la moyenne empirique des $\left(y_i^\bullet\right)_{i=1,\ldots,n}$, et l'estimation $\widehat{  \mu^{\bullet} }\left({\mathbf{ { y^{\bullet} } }}\right)$ ?)

<button id="ok_prodAB_q5_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_prodAB_q5">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>En évaluant la moyenne sur l'échantillon observé, i.e. en calculant $\widehat{  \mu^{\bullet} }\left({\mathbf{ { y^{\bullet} } }}\right)=\frac1n \sum_{i=1}^n y_i^\bullet=\overline{y^\bullet}$.</div></div></div>


<br/>(6) Quelle est la nature du paramètre d'intérêt $\mu^A$ dans le cas où les données ne sont que des 0 et 1 ? Désormais cette moyenne, puisqu'elle bénéficiera d'un traitement particulier, sera notée $p^A=\mu^A$.
 
<button id="ok_prodAB_q6_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_prodAB_q6">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>Une moyenne de 0 et de 1 correspond à une proportion.</div></div></div>



<h2> Exercice 3 : Procédé d'échantillonnage</h2>

Dans le but d'estimer un paramètre d'intérêt inconnu, on dispose d'un échantillon. Nous nous proposons maintenant de préciser plus en détail son procédé de construction.

<br/>(1) Proposez des critères de qualité d'un tel échantillon.
<br/>(2) A quoi correspond la notion de représentativité ?

<button id="ok_procEch_q1_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_procEch_q1">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>à essayer de faire "ressembler" l'échantillon à la population totale.</div></div></div>


<br/>(3) Est-il possible de construire un échantillon représentatif d'une (ou plusieurs) caractéristique(s) donnée(s) ?

<button id="ok_procEch_q2_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_procEch_q2">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>oui par exemple en tentant de respecter la proportion de femmes dans la population totale avec la proportion de femmes présentes dans l'échantillon.</div></div></div>



<br/>(4) Même question sans aucun a priori (i.e. aucune caractéristique fixée).
<br/>(5) Proposez un critère de qualité  qui permettra de construire un échantillon le plus représentatif sans aucun a priori.
 
<button id="ok_procEch_q3_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_procEch_q3">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>voir réponse ci-après.</div></div></div>


<br/>(6) Fournissez un (ou plusieurs) procédé(s) d'échantillonnage satisfaisant au critère suivant de représentativité (maximale) sans a priori (RSAP) :
<div class="ui yellow message">
<b>Tous</b> les individus de la population totale ont la même chance d'être choisi dans l'échantillon. 
</div>

<button id="ok_procEch_q4_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_procEch_q4">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>Selon ce critère, on pourrait choisir $n$ individus au hasard au sein de la population avec remise et sans remise. Notons qu'étant donné les ordres de grandeurs, $n=1000$ et $N=2000000$ ces deux procédés sont quasiment équivalents.</div></div></div>


<br/>(7) Si on répète le procédé d'échantillonnage suivant le critère RSAP et que pour chaque échantillon on évalue l'estimation du paramètre d'intérêt, pensez-vous que les résultats seront toujours les mêmes ? Comment qualifie-t-on alors la nature du procédé d'échantillonnage ?

<button id="ok_procEch_q5_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_procEch_q5">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>L'échantillonnage est dit aléatoire.</div></div></div>



<h2> Exercice 4 : Outil pour la problématique des élections</h2>


On se propose d'estimer le paramètre d'intérêt en fournissant un intervalle (ou fourchette, encadrement) obtenu à partir des données. Cet intervalle, appelé intervalle de confiance, est centré en la valeur de l'estimation et sa largeur dépend d'un niveau de confiance que l'on se fixe (généralement plutôt grand, par exemple, $95\%$).

<br/>(1) Pensez-vous qu'il soit possible qu'une estimation $\widehat{  p }\left({\mathbf{ { y } }}\right)$ soit égale au paramètre estimé? Pouvez-vous savoir l'ordre de grandeur de l'écart entre l'estimation et le paramètre inconnu?
Quel niveau de confiance accordez-vous à la valeur d'une estimation (dans notre exemple, $47\%$ et $52\%$ sur deux échantillons)?

<button id="ok_maxICSuite_q1_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_maxICSuite_q1">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>Excepté dans de très rares contextes, une estimation ne peut pas correspondre à la vraie valeur du paramètre inconu. Il n'y a aucun moyen de mesurer avec certitude l'écart entre l'estimation et le paramètre. Cependant, on peut seulement espérer qu'ils ne sont pas très éloignés. Compte tenu ce ces réponses, il est alors difficile de répondre à la dernière question autrement que de proposer un avis personnel plutôt arbitraire.</div></div></div>


<br/>(2) Si on vous annonce qu'un statisticien sait généralement fournir en plus de l'estimation du paramètre, l'estimation de sa fiabilité mesurée en terme de variabilité attendue, quel est la mission principale d'un intervalle de confiance ? Quelles sont les qualités souhaitées d'un intervalle de bonne confiance ($95\%$ par exemple) du paramètre d'intérêt (inconnu) ? 

<button id="ok_maxICSuite_q2_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_maxICSuite_q2">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>L'objectif est d'intégrer dans le procédé d'estimation du paramètre sa fiabilité (voir énoncé) afin de fournir un intervalle plus ou moins large selon le niveau de confiance  fixé.
La qualité attendue est que cet intervalle ait de bonnes chances (traduites par le niveau de confiance) de contenir le paramètre d'intérêt inconnu. En outre, on peut espérer obtenir un intervalle de longueur raisonnablement faible pour que l'estimation soit suffisamment informative (bien que l'on ne peut en être assuré en général).</div></div></div>


<br/>(3) Compléter les phrases suivantes : <button id="ok_maxIC_toggle" class="ui icon mini icon green button"><i class="check icon"></i></button>

<ol>
<li> PLUS le niveau de confiance est fort, <span class="hidden_ok_maxIC">....</span><span class="ok_maxIC">PLUS</span>
 l'intervalle de confiance est petit.</li>
<li> Vue comme un intervalle de confiance de largeur 0, une estimation peut donc être associé à un niveau de confiance <span class="hidden_ok_maxIC">....</span><span class="ok_maxIC">$0\%$</span>
.</li>
</ol>

<br/>(4) Un statisticien construit les intervalles à $95\%$ de confiance (via une formule d'obtention étudiée plus tard dans le cours ne faisant pas l'objet) et informe le candidat que les intervalles associés aux estimations $47\%$ et $52\%$ sont respectivement $[43.90655\%,50.09345\%]$ et $[48.90345\%,55.09655\%]$. Les élections effectuées, on évalue $p^{Max}=51.69\%$, qu'en pensez-vous ?

<button id="ok_maxICSuite_q3_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_maxICSuite_q3">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>Il semble qu'il soit difficile d'affirmer que le candidat sera élu.</div></div></div>


<br/>(5) Si vous avez des difficultés à traduire ce que signifie le niveau de confiance d'un intervalle, comparez-le avec celui que vous accorderiez à une personne qui serait censée dire la vérité avec un niveau de confiance fixé à $95\%$. Dans le cas de cette personne, comment traduiriez-vous (ou expliqueriez-vous) le concept de niveau de confiance ? 
<button id="ok_maxICSuite_q4_answer" class="ui icon mini icon green button"><i class="check icon"></i></button>

<div class="ok_maxICSuite_q4">
<div class="ui icon blue message"><i class="life ring icon"></i><div class="content"><div class="header">Réponse</div>Parmi toutes les assertions énoncées par cette personne (dont on peut vérifier la véracité ou fiabilité), $95\%$ (en moyenne) seraient censées être justes ou fiables.</div></div></div>



<div class="ui yellow message">Cet exemple nous aide à appréhender la notion de niveau de confiance ou plus généralement de probabilité d'un événement en l'exprimant comme la proportion parmi toutes (en théorie, on peut imaginer en faire une infinité) réalisations de l'expérience (a priori supposée aléatoire) qui conduisent à ce que l'événement soit vérifié. Ceci nous conduit naturellement vers la notion d'Approche Expérimentale des Probabilités qui sera présentée dans la fiche de Td suivante en complément de l'Approche Mathématique des Probabilités (qui est classiquement présentée dans les cours de Probabilités et Statistique).</div>
 





</div>

</div>

<script type="text/javascript">
if (typeof clipboardDemo == 'undefined') {
	clipboardDemo = new Clipboard('.clipboard');
	stateClip=false; //global variable
}
stateClip=false; //global variable
$(".clipboard").click(function(e) {stateClip=true;});
$(".demoR").click(function() {
  if(stateClip) {
    stateClip=false;
  } else {
    var state=$( this ).attr("state");
    var link_id=$( this ).attr("link_id");
    if(state=="on") {
      $("#code-"+link_id).hide();
      $("#session-"+link_id).show();
      $( this ).attr("state","off");
    } else {
      $("#code-"+link_id).show();
      $("#session-"+link_id).hide();
      $( this ).attr("state","on");
    }
  }
});
function prev_DemoRFigs(fig) {
  var curfig=demoRFigs[fig]['current'];
  var prevfig=demoRFigs[fig]['prev'][curfig];
  demoRFigs[fig]['figs'].forEach(function(e) {
    if(e == prevfig) {
      $("#img-"+fig+"-"+e).show();$("#code-"+fig+"-"+e).show();
    } else {
      $("#img-"+fig+"-"+e).hide();$("#code-"+fig+"-"+e).hide();
    }
  });
  demoRFigs[fig]['current']=prevfig;
}
function next_DemoRFigs(fig) {
  var curfig=demoRFigs[fig]['current'];
  var nextfig=demoRFigs[fig]['next'][curfig];
  demoRFigs[fig]['figs'].forEach(function(e) {
    if(e == nextfig) {
      $("#img-"+fig+"-"+e).show();$("#code-"+fig+"-"+e).show();
    } else {
      $("#img-"+fig+"-"+e).hide();$("#code-"+fig+"-"+e).hide();
    }
  });
  demoRFigs[fig]['current']=nextfig;
}
//init
$(".demoRSession").hide();
$('.ui.answer.accordion').accordion();
$('.ui.checkbox')
  .checkbox()
;
$('.quizz.checkbox').change(function () {
	var quizz = $(this).attr("quizz");
  update_checkbox_answer($(this));
	update_quizz_score(quizz);
});

function bonjour_quizz_checkbox() {
  var tag; 
  $('.quizz.checkbox').each(function() {
      tag = ($(this).attr("tag") % 2 == 1) ? atob("eWVz") : atob("bm8=");
      $('<input>').attr({
        type: 'hidden',
        class: 'quizz_answer',
        mode: 'checkbox',
        quizz: $(this).attr("quizz"),
        question: $(this).attr("question"),
        id: 'qa-'+$(this).attr("quizz")+'-'+$(this).attr("question")+"-"+$(this).attr("choice"),
        expected: tag,
        answer: '',
        score: 0
      }).insertAfter("#quizz-result-"+$(this).attr("quizz"));
      // if($('#qs-'+$(this).attr("quizz")+'-'+$(this).attr("question") ).length == 0) {
      //   $('<input>').attr({
      //     type: 'hidden',
      //     class: 'quizz_score',
      //     mode: 'checkbox',
      //     quizz: $(this).attr("quizz"),
      //     question: $(this).attr("question"),
      //     id: 'qs-'+$(this).attr("quizz")+'-'+$(this).attr("question"),
      //     score: 0
      //   }).insertAfter("#quizz-result-"+$(this).attr("quizz"));
      // }
  });
}

function update_checkbox_answer(elt) {
  var res, qa=$('#qa-'+elt.attr("quizz")+'-'+elt.attr("question")+"-"+elt.attr("choice"));
  var qa_score=parseInt(qa.attr("score"));
  qa.attr("answer", (elt.prop("checked") ? "yes" : "no" ));
  if(qa.attr("answer") === "no") {
    qa.attr("score",0);
  } else {
    qa.attr("score",qa.attr("expected") == "yes" ? 1 : -1 );
  }
  var qs=$('#qs-'+elt.attr("quizz")+'-'+elt.attr("question"));
  qs.attr("score",parseInt(qs.attr("score"))+parseInt(qa.attr("score"))-qa_score);
}

function update_minir_input_answer(id) {
  var elt=$("#"+id),score;
  var answer=elt.val(),qs=$('#qs-'+elt.attr("quizz")+'-'+elt.attr("question"));
  var id=elt.attr("quizz")+"-"+elt.attr("question");
  qs.attr("answer",answer);
  if(answer == "") {
    score="0";
  } else {
    console.log("ls: "+Opal.eval('QuizzScoreMiniR.ls'));
    var code='QuizzScoreMiniR["'+id+'"].eval("'+answer+'")';
    console.log("code: "+code);
    score=Opal.eval(code);
  }
  console.log("minir score:"+score);
  qs.attr("score",score);
}

function update_minir_textarea_answer(id) {
  var elt=$("#"+id),score;
  var answer=elt.val().split("\n").slice(-1)[0];
  var qs=$('#qs-'+elt.attr("quizz")+'-'+elt.attr("question"));
  var id=elt.attr("quizz")+"-"+elt.attr("question");
  qs.attr("answer",answer);

  console.log("ls: "+Opal.eval('QuizzScoreMiniR.ls'));
  var code='QuizzScoreMiniR["'+id+'"].eval("'+answer+'")';
  console.log("code: "+code);
  score=Opal.eval(code);

  console.log("minir score:"+score);
  qs.attr("score",score);
}

function update_quizz_score_old(quizz) {
  var result="", global=0, count=0, qs, score;
  $( ".quizz_score[quizz='"+quizz+"']").each(function() {
    count += 1;
    switch($(this).attr("mode")) {
    case "checkbox":
    console.log("qs:"+'#qs-'+$(this).attr("quizz")+'-'+$(this).attr("question") );
      qs=$('#qs-'+$(this).attr("quizz")+'-'+$(this).attr("question"));
      score=qs.attr("score");
      result += $(this).attr("question") + ": "+score+ ";";
      global += Math.max(0,score);
    case "minir":
        // QuizzScoreMiniR[""]
        // qs=$('#qs-'+$(this).attr("quizz")+'-'+$(this).attr("question"));
        // score=qs.attr("score");
        // result += $(this).attr("question") + ": "+score+ ";";
        // global += Math.max(0,score);
      break;
    }
  })
  $("#quizz-result-"+quizz).text("Note="+global.toFixed(2)+"/"+count+" ("+result+")");
}

function update_quizz_score(quizz) {
  console.log("update_quizz_score: "+quizz);
  var result="", global=0, count=0, qs, score,mode,smax;
  var questions=jQuery.unique($('.quizz[quizz="'+quizz+'"]').map(function() {return $(this).attr("question")})).toArray();
  console.log("question_s: "+questions);
  questions.forEach(function(question) {
    count += 1;
    mode=$('.quizz[quizz="'+quizz+'"][question="'+question+'"]').attr('mode');
    switch(mode) {
    case "checkbox":
      qs=$('#qs-'+quizz+'-'+question);
      score=qs.attr("score");smax=qs.attr("max");
      result += question + ": " + score + (smax=="1" ?  "" : ("/" + smax)) + ";";
      global += Math.max(0,score/smax);
      break;
    case "minir-input":
        qs=$('#qs-'+quizz+'-'+question);
        score=qs.attr("score");
        result += question + ": "+score+ ";";
        var id=quizz+'-'+question;
        //console.log(Opal.eval('QuizzScoreMiniR.ls'));
        //console.log('id='+id);
        var nb=Opal.eval('QuizzScoreMiniR["'+id+'"].nb_rules');
        //console.log("nb="+nb);
        global += Math.max(0,eval(score)/nb);
      break;
    case "minir-textarea":
        qs=$('#qs-'+quizz+'-'+question);
        score=qs.attr("score");
        result += question + ": "+score+ ";";
        var id=quizz+'-'+question;
        //console.log(Opal.eval('QuizzScoreMiniR.ls'));
        //console.log('id='+id);
        var nb=Opal.eval('QuizzScoreMiniR["'+id+'"].nb_rules');
        //console.log("nb="+nb);
        global += Math.max(0,eval(score)/nb);
      break;
    }
  });
  $("#quizz-result-"+quizz).text("Note="+global.toFixed(2)+"/"+count+" ("+result+")");
}

// function bonjour_quizz_miniR() {
//     var e=$("#quizz-result-"+$(this).attr("quizz"));
//     $('.quizz.minir').each(function() {
//        $('<input>').attr({
//         type: 'hidden',
//         class: 'quizz answer',
//         mode: 'minir',
//         quizz: $(this).attr("quizz"),
//         question: $(this).attr("question"),
//         id: 'qa-'+$(this).attr("quizz")+'-'+$(this).attr("question"),
//         answer: '',
//         score: 0
//        }).insertAfter(e)
//  });
// }

bonjour_quizz_checkbox();
//bonjour_quizz_miniR();
Cqls={Quizz: {}};
Cqls.code="";

function setCqlsCode(code) {
	Cqls.code=code;
}
function getExoData(exo) {
  var code;
  switch (exo) {
  case "alfredN20":
    code="yA=c(0.144679564279082, 0.308391019822987, 0.165071844320451, 0.0810088511346089,-0.150489835962709, -0.0216344580330839, -0.255587942544298,0.0987153563164697, 0.592751352277294, -0.229624997435348, -0.216767323099697,-0.0970720818772463, 0.170505292061653, -0.0573236584450232,0.653375135601917, 0.178024688692504, 0.292787345192972, -0.165149721585414,-0.300802214354508, 0.32129751773001)";
    break;
  case "alfred":
    code="yA=c(0.144679564279082, 0.308391019822987, 0.165071844320451, 0.0810088511346089,-0.150489835962709, -0.0216344580330839, -0.255587942544298,0.0987153563164697, 0.592751352277294, -0.229624997435348, -0.216767323099697,-0.0970720818772463, 0.170505292061653, -0.0573236584450232,0.653375135601917, 0.178024688692504, 0.292787345192972, -0.165149721585414,-0.300802214354508, 0.32129751773001, 0.0805886239932639, 0.143171545682753,-0.00298066490980145, -0.255637645785468, 0.0928007482527018,-0.153861013155069, -0.091326084306205, 0.296172089667303, 0.00686887343119331,-0.596877687513186, -0.0584200940407693, 0.0720811015026169,0.0175687232410191, 0.153389781110694, -0.44979678290783, 0.213281328016978,-0.0386525306111942, -0.081768580854734, -0.165385713923966,-0.454948636494848, 0.262084533688519, -0.215753300244686, 0.173626814513985,-0.20016068068908, -0.255138748345693, 0.125329351017599, -0.326049545254994,0.207517749735126, 0.0704389198591811, -0.303221493327114)";
    break;
  case "dictee":
    code="yD=c(9, 10, 0, 1, 0, 5, 6, 10, 8, 1, 13, 9, 8, 3, 0, 0, 1, 0, 0, 0, 6, 9, 6, 8, 3, 5, 11, 5, 0, 0)";
    break;
  case "dieteticien":
    code="yD=c(-1, 6, 4, 7, 7, 3, 2, 6, 3, 5, 5, 7, 4, 4, 2, 4, 6, 6, 5, 3, 5, 5, 2, 7, 4, 5, 4, 3, 6, 7, 4, 6, 4, 5, 2, 6, 4, 6, 5, 5, 6, 4, 3, 2, 3, 6, 5, 7, 2, 4);AV=c(64,67,68,76,72,69,62,65,64,73);AP=c(65,61,64,69,65,66,60,59,61,68)";
    break;

  case "produitA":
      code="yA=c(0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,0,1,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,0,1,0,0,1,0,0,0,0,1,0,1,0,1,0,0,0,1,1,0,1,0,1,0,0,0,0,0,0,1,1,0,0,1,0,0,0,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,1,0,0,0,0,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,0,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,0,0,1,1,0,0,1,1,1,0,0,1,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,0,1,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,1,0,1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,1,0,0,0,1,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,1,0,0,0,1,1,0,1,1,0,0,1,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,1,1,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0,1,0,1,0,0,0,0);"
      break;

    case "produitB":
      code="yB=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,0,0,2,0,0,0,0,2,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,2,0,0,2,0,0,0,2,0,2,2,2,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,2,3,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,3,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,0,0,0,0,0,3,0,1,0,2,0,0,0,0,2,0,1,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,3,0,0,1,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,2,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,0,0,0,0,0,0,0,0,0,2,0,0,0,0,2,0,0,0,0,0,0,0,1,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,0,1,0,2,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,3,0,0,0,0,0,1,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);"
      break;

    case "primeProdA":
      code="yQ=c(9,4,3,7,6,8,2,7,3,9,9,4,8,9,4,8,10,4,9,5,2,7,2,3,2,4,9,6,10,8,5,5,5,5,10,7,4,4,4,4,6,8,2,8,9,5,7,8,6,4,8,6,6,5,3,7,4,5,2,4,6,8,3,9,5,5,9,5,10,5,4,4,4,2,6,8,2,5,10,8,6,9,8,5,7,10,6,8,7,7,7,3,7,8,6,9,6,6,8,7,8,7,8,10,6,8,5,9,4,10,7,9,4,7,4,7,10,4,2,5,7,3,5,8,7,9,6,3,6,2,10,9,10,10,10,4,6,7,9,10,3,10,3,2,9,5,6,9,8,9,7,10,6,5,4,9,5,6,4,2,6,7,5,6,10,8,6,5,9,7,2,2,2,8,9,6,3,8,7,6,3,8,10,2,2,8,9,10,9,8,2,7,7,10,3,3,2,9,7,6);"
      break;

    case "competence":
      code="yC=c(0.3452062,0.3618771,0.2832608,-0.04273267,0.07897429,-0.5758346,-0.7199432,0.181882,0.04438047,-0.01951828,-0.3482005,0.2606782,-0.211132,-0.288865,-0.1782186,0.08062292,0.5697587,0.2163659,-0.05521338,-0.4348432,-0.08501561,0.05719431,-0.1577344,0.08525453,0.3121257,0.1269254,-0.178035,-0.1786163,-0.4814323,-0.07185419);"
      break;

    case "pilote1N20":
      code="y1=c(47.89674,50.04087,54.5324,54.36718,48.80645,51.44077,49.72669,44.81843,50.3791,48.32037,53.5515,50.38611,50.37899,49.44585,50.47262,50.66881,50.44251,50.10745,47.43873,51.17308);"
      break;

    case "pilote1":
      code="y1=c(47.89674,50.04087,54.5324,54.36718,48.80645,51.44077,49.72669,44.81843,50.3791,48.32037,53.5515,50.38611,50.37899,49.44585,50.47262,50.66881,50.44251,50.10745,47.43873,51.17308,51.1604,50.06874,48.85899,52.08231,49.59702,52.87073,50.63278,50.04054,53.13216,50.13489,53.72466,50.48863,48.83423,51.93978,49.19886,52.67034,49.2136,48.35678,49.43116,48.95199);"
      break;

    case "pilote2":
      code="y2=c(51.89371,51.35814,52.16305,51.83228,52.97653,51.43513,50.8937,51.50756,51.54468,52.22917,51.21122,52.96252,51.61797,52.40225,50.21097,51.73468,52.1436,52.57952,51.60721,52.15696,51.51422,53.23509,53.55053,52.62854,51.3968,52.51582,51.7682,53.42508,52.59148,51.55015,53.02435,52.20928,52.13902,52.04843,53.60312,50.48255,51.36794,52.73886,50.4655,51.92149,50.82357,53.11825,52.30076,49.99984,52.47019,51.9189,52.68014,51.25526,53.55974,52.44708);"
      break;

    case "bernardN20":
      code="yB=c(0.02483016,0.09379133,0.145188,-0.04969999,-0.1532143,0.1208757,-0.112933,-0.3452917,-0.007106278,0.1220161,-0.1919765,-0.3684244,0.1882093,-0.1190619,-0.2020528,0.2495189,-0.3013964,0.1123033,0.2164801,0.2393351);"
      break;

    case "bernard":
      code="yB=c(0.02483016,0.09379133,0.145188,-0.04969999,-0.1532143,0.1208757,-0.112933,-0.3452917,-0.007106278,0.1220161,-0.1919765,-0.3684244,0.1882093,-0.1190619,-0.2020528,0.2495189,-0.3013964,0.1123033,0.2164801,0.2393351,0.1428402,-0.323352,0.04930722,-0.02417904,0.1530558,0.1237836,-0.006933568,-0.06470596,0.1438609,0.02115967,-0.1333253,0.3044679,0.04528947,0.06454683,0.03938363,0.4622106,-0.1950227,-0.009857142,0.08429325,-0.04374064,-0.278324,0.3768047,-0.1410857,-0.01711132,0.04389444,0.07555481,0.2506217,0.3180829,0.005132367,0.0152481,0.2962752,-0.1621414,0.06079287,0.09097692,0.1198565,0.310566,-0.1467855,0.06196827,-0.1821278,-0.1878903);"
      break;

    case "conduite":
      code="yH=c(24,28,29,29,34,36,40,41,60);yF=c(21,31,34,37,38,39,42,43,44,50,51);"
      break;

    case "adjverbe":
      code="sc=c(1.04,0.93,0.75,0.33,1.62,0.76,0.97,1.21,0.8,1.18);litt=c(1.32,2.3,1.98,0.59,1.02,0.88,0.92,1.39,1.95,1.25);"
      break;

    case "machine":
      code="yM1=c(1844,1828,1837,1833,1831,1818,1836,1837,1840,1820,1845,1815,1831,1839,1824,1839,1836,1840,1822,1824,1820,1839,1849,1846,1817,1822,1832,1846,1832,1834,1847,1828,1809,1833,1830,1824,1834,1842,1837,1818,1812,1825,1839,1840,1817,1827,1827,1842,1846,1839,1822,1816,1834,1810,1826,1836,1834,1839,1832,1827,1847,1842,1844,1831,1840,1823,1828,1822,1804,1821,1823,1846,1836,1823,1831,1810,1838,1844,1830,1830,1829,1807,1797,1814,1807,1844,1834,1827,1841,1830,1830,1834,1840,1832,1844,1815,1825,1821,1840,1821);yM2=c(2025,2045,2017,2024,2016,2025,2023,2020,2008,2025,2017,2014,2024,2028,2009,2023,2024,2034,2023,2024,2029,2032,2013,2017,2019,2022,2023,2005,2031,2012,2014,2032,2018,2022,2035,2024,2034,2012,2017,2015,2020,2015,2018,2020,2033,2025,2026,2026,2023,2014);"
      break;

    case "menu":
      code="yAV=c(8,7,6,7,9,7,6,4,7,5,8,7,6,6,6,6,7,5,7,6,7,7,8,5,4,7,6,5,7,6,8,6,7,7,7,8,5,8,5,5);yAP1=c(9,9,9,6,7,7,9,6,8,6,10,11,6,9,8,8,6,10,7,10,6,8,7,8,9,6,9,9,6,7);yAP2=c(8,10,8,8,9,8,9,5,10,6,10,7,7,6,6,7,11,7,12,6,7,7,10,6,7,7,7,5,8,8,10,6,9,8,8,9,5,10,7,8);"
      break;

    case "notes":
      code="yContC=c(16,16,12,16,11,10,15,19,12,14,17,16,12,10,17,16,12,14,11,16,18,20,13,14,9,10,18,7,6,10,17,18,11,17,14,16,12,12,13,13,12,16,11,15,19,14,16,13,17,18);yExamC=c(14,17,15,13,13,13,12,16,13,15,12,14,13,15,17,15,17,13,13,12,15,14,12,13,9,10,16,11,16,13,13,14,13,15,11,16,14,10,8,15,10,12,12,12,15,10,15,9,13,11);yExamD=c(13,13,11,10,13,11,12,11,9,13,10,11,12,14,11,11,10,17,10,7,17,11,9,10,14,11,9,11,10,10,12,11,12,12,10,9,12,12,10,11,8,5,14,9,12,11,11,9,11,11);"
      break;

    case "chAffN20":
      code="yP1=c(98.83,96.56,86.08,84.08,93.68,106.74,93.42,104.04,99.24,87.47,117.65,115.26,109.33,92.71,105.48,93.09,106.59,82.92,96.31,87.99);yP2=c(63.89,72.36,88.48,74.28,71.63,82.45,67.42,76.01,74.33,77.81,71.67,72.38,80.33,77.67,67.29,73.98,65.97,76.65,74.02,88.96);"
      break;

    case "chAff":
      code="yP1=c(98.83,96.56,86.08,84.08,93.68,106.74,93.42,104.04,99.24,87.47,117.65,115.26,109.33,92.71,105.48,93.09,106.59,82.92,96.31,87.99,99.77,111.22,106.49,100.8,109.97,96.91,83.39,101.57,100.1,110.07,94.03,114.85,105.3,106.5,88.68,100.94,98.4,101.98,112.11,79.68);yP2=c(63.89,72.36,88.48,74.28,71.63,82.45,67.42,76.01,74.33,77.81,71.67,72.38,80.33,77.67,67.29,73.98,65.97,76.65,74.02,88.96,71.19,81.9,75.03,80.35,86.16,73.15,73.94,63.95,79.94,59.04,67.5,77.15,74.01,77.45,78.13,74.46,96.59,80,78.19,72.97);"
      break;

    case "chAff0405N20":
      code="y04=c(84.03,95.47,88.89,93.09,87.24,90,86.85,86.61,73.24,73.88,97.2,96.47,85.61,64.47,67.98,78.2,86.76,81.73,74.35,83.55);y05=c(98.83,96.56,86.08,84.08,93.68,106.74,93.42,104.04,99.24,87.47,117.65,115.26,109.33,92.71,105.48,93.09,106.59,82.92,96.31,87.99);"
      break;

    case "chAff0405":
      code="y04=c(84.03,95.47,88.89,93.09,87.24,90,86.85,86.61,73.24,73.88,97.2,96.47,85.61,64.47,67.98,78.2,86.76,81.73,74.35,83.55,85.15,76.67,87.75,84.52,104.08,72.72,101.8,87.52,86.61,89.96,76.96,95.11,70.88,89.79,87.29,83.36,73.73,79.94,91.97,100.07);y05=c(98.83,96.56,86.08,84.08,93.68,106.74,93.42,104.04,99.24,87.47,117.65,115.26,109.33,92.71,105.48,93.09,106.59,82.92,96.31,87.99,99.77,111.22,106.49,100.8,109.97,96.91,83.39,101.57,100.1,110.07,94.03,114.85,105.3,106.5,88.68,100.94,98.4,101.98,112.11,79.68);"
      break;

    case "tailleEtu":
      code="y1=c(165,179,171,178,171,168,166,171,182,178,177,165,174,164,175,178,167,168,185,166,162,180,167,174,159,159,184,154,172,157)";
      break;
  }
  Cqls.code=code;
  return code;
}

function irb(instrR) {
  return eval(Opal.compile("("+Cqls.code+";"+instrR+").to_Routput",{irb: true}));
}

function preprocessCode(instrR) {
  return instrR.replace(/\<\-/g,"=").replace(/([^\d])(\.\d+)/g,"$1"+"0"+"$2").replace(/\^/g,"**");
}

function evalMiniR(id) {
  var instrR=$("#code-"+id).val()+';'+$("#"+id).val();
  instrR=preprocessCode(instrR);
  var res=irb(instrR);//Opal.eval("("+instrR+")");//eval(Opal.compile(instrR,{irb: true}));
  $("#echo-"+id).html(res);//print(res));
}

function evalMiniRCurrentLine(id) {
  console.log("evalMiniRCurrentLine: "+id);
  var instrsR=$("#"+id).val();
  var debut=instrsR.substr(0,$("#"+id).prop("selectionStart"));
  var line=(debut.split("\n")).length;
  //alert("line="+line);
  var instrR=instrsR.split("\n")[line-1];

  //preliminary code to eval
  irb(preprocessCode($("#code-"+id).val()));
  //textarea current line evaluation
  instrR=preprocessCode(instrR);
  var res=irb(instrR);//Opal.eval("("+instrR+")");//eval(Opal.compile(instrR,{irb: true}));
  $("#echo-"+id).html(res);//print(res));
}

$(".quizz.minir.textarea").keydown(function(e) {
  if((e.metaKey || e.ctrlKey) && ( String.fromCharCode(e.which).toLowerCase() === 'r')) {
    evalMiniR($(this).attr("id"));
    //validAnswer
    update_minir_textarea_answer($(this).attr("id"));
    update_quizz_score($(this).attr("quizz"));

  }
  if((e.metaKey || e.ctrlKey) && ( String.fromCharCode(e.which).toLowerCase() === 'l')) {
    evalMiniRCurrentLine($(this).attr("id"));
  }
  // if( (e.metaKey || e.ctrlKey) && ( String.fromCharCode(e.which).toLowerCase() === 'v') ) {
  //   //validAnswer
  //   update_minir_textarea_answer($(this).attr("id"));
  //   update_quizz_score($(this).attr("quizz"));
  // }

});

$(".quizz.minir.input").keydown(function(e) {
  if(e.which == 13) {
    evalMiniR($(this).attr("id"));
    //validAnswer
    update_minir_input_answer($(this).attr("id"));
    update_quizz_score($(this).attr("quizz"));
  }

});
$("#ok_max_pop_answer").click(function() {
$(".ok_max_pop").toggle()
});
$(".ok_max_pop").hide();
$("#ok_max_ech_answer").click(function() {
$(".ok_max_ech").toggle()
});
$(".ok_max_ech").hide();
$("#ok_max_2echs_answer").click(function() {
$(".ok_max_2echs").toggle()
});
$(".ok_max_2echs").hide();
$("#ok_max_autres_pbs_answer").click(function() {
$(".ok_max_autres_pbs").toggle()
});
$(".ok_max_autres_pbs").hide();
$("#ok_prodAB_q1_answer").click(function() {
$(".ok_prodAB_q1").toggle()
});
$(".ok_prodAB_q1").hide();
$("#ok_prodAB_q2_answer").click(function() {
$(".ok_prodAB_q2").toggle()
});
$(".ok_prodAB_q2").hide();
$("#ok_prodAB_q3_answer").click(function() {
$(".ok_prodAB_q3").toggle()
});
$(".ok_prodAB_q3").hide();
$("#ok_prodAB_q4_answer").click(function() {
$(".ok_prodAB_q4").toggle()
});
$(".ok_prodAB_q4").hide();
$("#ok_prodAB_q5_answer").click(function() {
$(".ok_prodAB_q5").toggle()
});
$(".ok_prodAB_q5").hide();
$("#ok_prodAB_q6_answer").click(function() {
$(".ok_prodAB_q6").toggle()
});
$(".ok_prodAB_q6").hide();
$("#ok_procEch_q1_answer").click(function() {
$(".ok_procEch_q1").toggle()
});
$(".ok_procEch_q1").hide();
$("#ok_procEch_q2_answer").click(function() {
$(".ok_procEch_q2").toggle()
});
$(".ok_procEch_q2").hide();
$("#ok_procEch_q3_answer").click(function() {
$(".ok_procEch_q3").toggle()
});
$(".ok_procEch_q3").hide();
$("#ok_procEch_q4_answer").click(function() {
$(".ok_procEch_q4").toggle()
});
$(".ok_procEch_q4").hide();
$("#ok_procEch_q5_answer").click(function() {
$(".ok_procEch_q5").toggle()
});
$(".ok_procEch_q5").hide();
$("#ok_maxICSuite_q1_answer").click(function() {
$(".ok_maxICSuite_q1").toggle()
});
$(".ok_maxICSuite_q1").hide();
$("#ok_maxICSuite_q2_answer").click(function() {
$(".ok_maxICSuite_q2").toggle()
});
$(".ok_maxICSuite_q2").hide();
$("#ok_maxIC_toggle").click(function() {
;$(".ok_maxIC").toggle();$(".hidden_ok_maxIC").toggle();
});
$(".ok_maxIC").hide();$(".hidden_ok_maxIC").show();
$("#ok_maxICSuite_q3_answer").click(function() {
$(".ok_maxICSuite_q3").toggle()
});
$(".ok_maxICSuite_q3").hide();
$("#ok_maxICSuite_q4_answer").click(function() {
$(".ok_maxICSuite_q4").toggle()
});
$(".ok_maxICSuite_q4").hide();
$(".trigger_doc").click(function() {
  var target_id='#target_doc' + $( this ).attr("id").substring(11);
  $( target_id ).toggle();
  var expand_id='#tri_expand' + $( this ).attr("id").substring(11);
  if( $(expand_id).attr("state") == 'off') {
    $(expand_id).html('&#x25BC;');
    $(expand_id).attr("state",'on');
  } else if( $(expand_id).attr("state") == 'on') {
    $(expand_id).html('&#x25BA;');
    $(expand_id).attr("state",'off');
  } else {
    console.log("Not found");
  }
  
});
$(".target_doc").hide();
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>


</body>
</html>
